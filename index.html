<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kraken Media Slideshow (scaling only)</title>
<style>
  html,body{height:100%;margin:0}
  body{background:#000;color:#eaeaea;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}

  /* ===== Player stage ===== */
  .stage{
    position:relative;width:100vw;height:100vh;overflow:hidden;
    display:flex;align-items:center;justify-content:center;
    background:var(--bg,#000);
  }

  .media{position:absolute;inset:0;margin:auto;max-width:100%;max-height:100%;display:none;object-fit:contain}
  .show{display:block}
  .fade{transition:opacity 300ms ease;opacity:0}
  .fade.show{opacity:1}

  .media{
    transform-origin:50% 50%;
    transform:
      translate(var(--tx,0%), var(--ty,0%))
      scale(var(--scale,1))
      rotate(var(--rot,0deg));
  }

  /* ===== Configure UI ===== */
  .wrap{max-width:1200px;margin:24px auto;padding:0 16px}
  h1{font-size:1.25rem;margin:0 0 14px}
  .grid{display:grid;gap:12px}
  .cols-2{grid-template-columns:1fr 1fr}
  .card{background:#121212;border-radius:12px;padding:16px;box-shadow:0 6px 20px rgba(0,0,0,.25);margin-bottom:14px}
  label{display:block;margin:8px 0 6px;font-weight:600}
  input[type="text"],input[type="number"],textarea,select{width:100%;padding:10px;border-radius:8px;border:1px solid #333;background:#0e0e0e;color:#eaeaea}
  textarea{min-height:120px;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .actions{display:flex;gap:10px;flex-wrap:wrap}
  button{padding:10px 14px;border:0;border-radius:10px;cursor:pointer;background:#6d5ef9;color:#fff;font-weight:700}
  .secondary{background:#2b2b2b}
  .danger{background:#ef4444}
  .muted{color:#aaa;font-size:.9rem}
  .value{min-width:3ch;display:inline-block;text-align:right}

  /* Playlist list */
  .list{list-style:none;margin:0;padding:0}
  .item{
    display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:center;
    background:#0f0f0f;border:1px solid #272727;border-radius:10px;padding:10px;margin:8px 0;
  }
  .grab{cursor:grab;user-select:none;font-weight:700;padding:6px 8px;background:#1b1b1b;border-radius:8px}
  .dragging{opacity:.6}
  .u{width:100%}
  .opt{width:240px}
  .rm{background:#ef4444}
  .prev{background:#10b981}
  .edit{background:#334155}
  .selected{outline:2px solid #6d5ef9}

  /* Inspector */
  .inspector-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .inspector-grid.full{grid-template-columns:1fr}
  .badge{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;background:#1f2937;font-size:.85rem}

  .import-panel{display:none}
  .import-panel.show{display:block}
</style>
</head>
<body>

<!-- Player (device renderer) -->
<div id="player" class="stage" style="display:none">
  <img id="imgEl" class="media fade" alt="media">
  <video id="vidEl" class="media fade" muted playsinline preload="auto"></video>
</div>

<!-- Configure -->
<div id="config" class="wrap" style="display:none">
  <h1>Kraken Media Slideshow - Configure</h1>

  <div class="card">
    <div class="actions">
      <button id="add">Add item</button>
      <button id="toggleImport" class="secondary">Import from text</button>
      <button id="exportTxt" class="secondary">Export to text</button>
      <button id="save">Save</button>
      <button id="load" class="secondary">Load</button>
      <button id="clear" class="secondary">Clear</button>
      <button id="editMode" class="secondary">Enter edit mode</button>
    </div>
    <ul id="list" class="list"></ul>
    <div id="importPanel" class="import-panel card">
      <label>Paste playlist text</label>
      <textarea id="importText"></textarea>
      <div class="actions"><button id="importApply">Import</button><button id="importCancel" class="secondary">Cancel</button></div>
    </div>
  </div>

  <!-- Global crop and alignment -->
  <div class="card">
    <h3>Global crop and alignment</h3>
    <div class="row">
      <div>
        <label>Zoom</label>
        <input id="scale" type="range" min="100" max="300" value="100">
        <div class="muted">Scale: <span id="scaleVal" class="value">100</span>%</div>
      </div>
      <div>
        <label>Rotation (deg)</label>
        <input id="rot" type="range" min="-180" max="180" value="0">
        <div class="muted"><span id="rotVal" class="value">0</span>Â°</div>
      </div>
    </div>
    <div class="row">
      <div>
        <label>Offset X (%)</label>
        <input id="tx" type="range" min="-50" max="50" value="0">
        <div class="muted"><span id="txVal" class="value">0</span>%</div>
      </div>
      <div>
        <label>Offset Y (%)</label>
        <input id="ty" type="range" min="-50" max="50" value="0">
        <div class="muted"><span id="tyVal" class="value">0</span>%</div>
      </div>
    </div>
  </div>
</div>

<script>
  // simplified for scaling behaviour
  const K_PLAYLIST = "krakenPlaylist";
  const K_OPTIONS  = "krakenOptions";

  const isKraken = new URLSearchParams(location.search).get("kraken") === "1";
  document.getElementById(isKraken ? "player" : "config").style.display = isKraken ? "flex" : "block";

  function applyVisual(stageEl, imgEl, vidEl, o){
    [imgEl,vidEl].forEach(el=>{
      el.style.setProperty('--scale', o.scale || 1);
      el.style.setProperty('--rot',   (o.rotDeg||0) + 'deg');
      el.style.setProperty('--tx',    (o.txPct||0) + '%');
      el.style.setProperty('--ty',    (o.tyPct||0) + '%');
    });
  }
</script>
</body>
</html>
